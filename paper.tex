\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{diffcoeff}
\usepackage{float}
\usepackage{pgf}
\usepackage{indentfirst}
\usepackage[labelfont=bf,skip=5pt]{caption}

\usepackage[backend=bibtex,style=nature,hyperref=true,autocite=superscript]{biblatex}
\addbibresource{paper.bib}

\usepackage{hyperref}
\hypersetup{
  colorlinks = true,
  allcolors = blue
}

%\usepackage{layouts}

\newcommand{\abs}[1]{\left | #1 \right |}
\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}

\title{Modeling of COVID-19 death cases in Spain by Differential Equation}
\author{Bao-Hiep Le}
\date{\today}

\topmargin -1in
\textheight 9in
\oddsidemargin -.25in
\evensidemargin -.25in
\textwidth 7in

\begin{document}

\maketitle

% Set this value as figure width in matplotlib
%\printinunitsof{in}\prntlen{\textwidth}

\section*{Data}

This paper uses data from \texttt{Our World in Data COVID-19 dataset} \autocite{owid-covid-data}.

The period chosen is April 1 to April 30, 2020. Table \ref{table:1} gives some samples from that period.

\begin{table}[h!]
\centering
\begin{tabular}{ |c|c| }
  \hline
  \textbf{Date} & \textbf{Total number death cases} \\
  \hline
  April 1, 2020 & 9387 \\
  April 2, 2020 & 10348 \\
  April 3, 2020 & 11198 \\
  April 4, 2020 & 11947 \\
  April 5, 2020 & 12641 \\
  \hline
\end{tabular}
\caption{Total number of COVID-19 death cases in Spain from April 1 to April 5, 2020.}
\label{table:1}
\end{table}

\section*{Model}

Let $P(t)$ be the total number of death cases $t$ days after April 1, 2020.
The growth rate $\diff{P}{t}$, which represents daily new death cases,
is calculated using the formula:

\begin{align} \label{rate_formula}
\diff{P}{t}(t_i) =
\renewcommand{\arraystretch}{2.5}\left\{\begin{array}{@{}l@{\quad}l@{}}
  \dfrac{1}{2} \left [ P(t_{i + 1}) - P(t_{i - 1}) \right ] &\text{if } 0 < i < n \\
  P(t_{1}) - P(t_{0}) &\text{if } i = 0 \\
  P(t_{n}) - P(t_{n - 1}) &\text{if } i = n \\
\end{array}\right.\kern-\nulldelimiterspace
\end{align}

%Table \ref{table:2} gives sample values of $P$, $\diff{P}{t}$, and the relative growth rate $\frac{1}{P} \diff{P}{t}$.

\begin{table}[h!]
\centering
\begin{tabular}{ |c|c|c|c|c|c|c| }
  \hline
  $t$ (days) & 0 & 2 & 4 & 6 & 8 & 10\\
  \hline
  $P$ (observed) & 9387 & 11198 & 12641 & 14045 & 15447 & 16606 \\
  \hline
  $\diff{P}{t}$ & 961.0 & 799.5 & 697.0 & 725.5 & 644.5 & 564.0 \\
  \hline
  $\frac{1}{P} \diff{P}{t}$ & 0.102376 & 0.071397 & 0.055138 & 0.051655 & 0.041723 & 0.033964 \\
  \hline
\end{tabular}
\caption{Sample values of $P$, $\diff{P}{t}$, and the relative growth rate $\frac{1}{P} \diff{P}{t}$.}
\label{table:2}
\end{table}

\begin{figure}[H]
  \begin{center}
    \input{fig1.pgf}
  \end{center}
  \caption{Total number of COVID-19 death cases in Spain from April 1 to April 30, 2020.}
\end{figure}

For this paper, we use a variant of the Logistic Growth Model:

\begin{equation} \label{model_eqn}
\frac{1}{P} \cdot \diff{P}{t} = aP + b
\end{equation}

The coefficients $a$ and $b$ are determined using least squares polynomial fit:

\begin{align} \label{coef}
\begin{split}
a &= -4.827879002776788 \times 10^{-6} \\
b &= 0.12215521367938273
\end{split}
\end{align}

\begin{figure}[H]
  \begin{center}
    \input{fig3.pgf}
  \end{center}
  \caption{Relative growth rate, $\frac{1}{P} \cdot \diff{P}{t}$ (red points), as a function of $P$ and the best fitted line (blue).}
\end{figure}

\section*{Solving Differential Equation}

Equation \ref{model_eqn} is separable. We have:

\begin{equation}
\frac{\dl{P}}{P(aP + b)} = \dl{t}
\end{equation}

Integrate both sides;

\begin{equation} \label{int_eqn}
\int \frac{\dl{P}}{P(aP + b)} = \int \dl{t}
\end{equation}

To evaluate the integral on the left side, we use partial fraction decomposition:

\begin{equation*}
\frac{1}{P(aP + b)} = \frac{X}{P} + \frac{Y}{aP + b}
\end{equation*}

Multiplying both sides of this equation by $P(aP + b)$ and rearranging the terms, we have:

\begin{equation*}
1 = (Xa + Y)P + Xb
\end{equation*}

The polynomials are identical, so their coefficients must be equal:

\begin{align*}
Xa + Y &= 0 \\
Xb &= 1
\end{align*}

We get $X = \dfrac{1}{b}$ and $Y = \dfrac{-a}{b}$. Therefore:

\begin{equation*}
\frac{1}{P(aP + b)} = \frac{1}{b} \cdot \frac{1}{P} - \frac{a}{b} \cdot \frac{1}{aP + b}
\end{equation*}

We can now rewrite equation \ref{int_eqn} as:

\begin{align*}
\int \left ( \frac{1}{b} \cdot \frac{1}{P} - \frac{a}{b} \cdot \frac{1}{aP + b} \right ) \dl{P} &= \int \dl{t} \\
\frac{1}{b} \ln \abs{P} - \frac{1}{b} \ln \abs{aP + b} &= t + C \\
\ln \abs{\frac{P}{aP + b}} &= bt + bC \\
\abs{\frac{P}{aP + b}} &= e^{bt + bC} = e^{bt}e^{bC} \\
\frac{P}{aP + b} &= Ae^{bt} \numberthis \label{int2_eqn}
\end{align*}

where $A = \pm e^{bC}$. Solving for P, we get:

\begin{equation} \label{final_eqn}
P = \frac{bAe^{bt}}{1 - aAe^{bt}}
\end{equation}

The growth rate is:

\begin{equation} \label{final_rate_eqn}
\diff{P}{t} = \frac{b^2Ae^{bt}}{\left ( 1 - aAe^{bt} \right ) ^2}
\end{equation}

We find the value of A by putting $t = 0$ in equation \ref{int2_eqn}:

\begin{equation*}
A = \frac{P_0}{aP_0 + b}
\end{equation*}

Substituting coefficients from \ref{coef} and $P_0 = 9387$:

\begin{equation*}
A = 122169.433209181
\end{equation*}

\begin{figure}[H]
  \begin{center}
    \input{fig4.pgf}
  \end{center}
  \caption{Total number of COVID-19 death cases in Spain from April 1 to
  April 30, 2020 from official data (red points). The blue line is the
  theoretical prediction using equation \ref{final_eqn} with
  $a = -4.827879002776788 \times 10^{-6}$,
  $b = 0.12215521367938273$, and $A = 122169.433209181$.}
\end{figure}

\begin{figure}[H]
  \begin{center}
    \input{fig5.pgf}
  \end{center}
  \caption{The growth rate of $P(t)$ calculated using formula \ref{rate_formula} (red points)
  and theoretical prediction using equation \ref{final_rate_eqn}.}
\end{figure}

\section*{Discussion}

The source code of this paper is published at
\url{https://github.com/hieplpvip/mth252-assignment}.

\printbibliography

\end{document}
